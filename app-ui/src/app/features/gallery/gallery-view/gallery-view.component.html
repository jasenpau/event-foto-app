<div class="gallery">
  <div class="page-header">
    <div class="gallery__header">
      <app-button [link]="'/event/' + eventId" [type]="ButtonType.Text">Grįžti į renginio informaciją</app-button>
      <h2 class="text-headline-large no-margin">{{ galleryDetails?.name }}</h2>
      <div>
        <app-button
          [type]="ButtonType.Text"
          (click)="openGalleryEditForm()">
          Pervadinti
        </app-button>
        <app-button
          [type]="ButtonType.Text"
          [disabled]="imageData.length !== 0 || galleryDetails?.isMainGallery"
          (click)="deleteGallery()">
          Ištrinti galeriją
        </app-button>
      </div>
      <app-upload-photo-form
        [eventId]="eventId!"
        [galleryId]="galleryId!"
        (photoUploadStarted)="handlePhotoUpload()"
      />
    </div>
  </div>
  <div class="gallery__toolbar">
    <p class="gallery__selected-count text-body-large no-margin">Pažymėta nuotraukų: {{ selectedImageIds.size }}</p>
    <app-button [type]="ButtonType.Filled" (click)="markAll()">Pažymėti visas</app-button>
    <app-button [type]="ButtonType.Text" [disabled]="selectedImageIds.size === 0" (click)="unmarkAll()">Panaikinti žymėjimą</app-button>
    <app-button [type]="ButtonType.Text" [disabled]="selectedImageIds.size === 0" (click)="openMovePhotosForm()">Perkelti į kitą galeriją</app-button>
    <app-button [type]="ButtonType.Text" [disabled]="selectedImageIds.size === 0" (click)="bulkDownload()">Atsisiųsti</app-button>
    <app-button [type]="ButtonType.Text" [disabled]="selectedImageIds.size === 0" (click)="bulkDelete()">Ištrinti</app-button>
  </div>
  <div class="gallery__grid">
    <div class="gallery__item" *ngFor="let image of imageData; index as i">
      <!-- eslint-disable-next-line -->
      <div class="gallery__item-selector" (click)="togglePhotoSelect(image)">
        <div class="gallery__item-selector-check" [ngClass]="{ 'gallery__item-selector-check--selected': selectedImageIds.has(image.id) }"></div>
      </div>
      <img
        *ngIf="image.isProcessed"
        [src]="sasUri?.baseUri + '/event-' + eventId + '/thumb-' + image.processedFilename + '?' + sasUri?.params"
        class="gallery__image"
        (click)="handlePhotoClick(image, i)"
        (keydown)="handlePhotoKeyboard($event, image, i)"
        [alt]="image.processedFilename"
        tabindex="0" />
    </div>
  </div>
  <div #scrollAnchor class="scroll-anchor"></div>
  <div class="gallery__loader" *ngIf="isLoading">
    <app-spinner />
  </div>
</div>
<app-photo-view
  *ngIf="openedPhotoData"
  [externalLoader]="isLoading"
  [openPhotoData]="openedPhotoData"
  (photoAction)="handlePhotoViewAction($event)"
/>
<app-side-view *ngIf="showGalleryEditForm && galleryDetails">
  <app-create-gallery-form
    [eventId]="galleryDetails.eventId"
    [galleryToEdit]="galleryDetails"
    (formEvent)="handleGalleryEditFormEvent($event)"
  />
</app-side-view>
<app-side-view *ngIf="showMovePhotosForm && eventId && galleryId">
  <app-move-photos-form
    [eventId]="eventId"
    [currentGalleryId]="galleryId"
    [selectedPhotoIds]="selectedImageIds"
    (formEvent)="handleMovePhotosFormEvent($event)"
  />
</app-side-view>
